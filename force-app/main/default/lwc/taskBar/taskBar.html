<template>
     <div id="home" class="page">
            <div class="dashboard-grid">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Today's Tasks</h2>

                        <div class="task-filter-panel">
                            <input type="date" class="filter-date-task" onchange={filterTaskByDate} max={today}>
                            <button class="btn btn-info" onclick={getTodaysTask}>Today</button>
                        </div>

                        <button class="btn btn-success" id="addTaskBtn" onclick={openTaskForm} disabled={disableTaskButton}>
                            {taskButtonTitle}
                        </button>
                    </div>
                    <div class="section-content">

                        <div class="loader" if:true={isLoading}>
                            <lightning-spinner
                                alternative-text="Loading..."
                                size="medium"
                                variant="brand">
                            </lightning-spinner>
                        </div>


                        <table class="data-table">
                        
                            <thead>
                                <tr>
                                    <th>Task Title</th>
                                    <th>Time Range</th>
                                    <th>Duration</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>

                            
                            <tbody id="tasksTableBody" if:true={tasks.length}>
                                <template for:each={tasks} for:item="task">
                                    <tr key={task.id}>
                                        <td class="font-weight-bold">{task.title}</td>
                                        <td><code>{task.startTime} - {task.endTime}</code></td>
                                        <td>
                                            <span class="status-badge status-in">
                                                {task.formattedDuration}
                                            </span>
                                        </td>
                                        <td class="text-muted">{task.description}</td>
                                        <td>
                                            <button class="btn btn-primary" onclick={editTask} data-id={task.id}>Edit</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>

                            <tbody id="tasksTableBodyEmpty" if:false={tasks.length}>
                                <tr>
                                    <td colspan="5" class="empty-state">
                                        <div class="empty-state-title">No tasks recorded</div>
                                        <div>Click "Add Task" to start tracking your work</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class={statusPanel.class} id="statusPanel">
                    <div class="status-indicator">{statusPanel.indicator}</div>
                    <div class="status-text" id="statusText">{statusPanel.text}</div>
                    <div class="status-detail" id="statusDetail">{statusPanel.workType}</div>
                    <div class="status-time" id="statusTime">{statusPanel.punchTime}</div>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
                        <div class="text-muted" style="font-size: 0.875rem;">Daily Total</div>
                        <div class="font-weight-bold" style="color: #2c5aa0;" id="dailyTotal">{statusPanel.dailyTotal}</div>
                    </div>
                </div>

            </div>
        </div>


        <div class="modal" id="taskModal" if:true={showTaskForm}>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">{modalTitle}</h3>
                <button class="modal-close" onclick={closeTaskForm}>&times;</button>
            </div>
            <form id="taskForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Task Title</label>
                        <input type="text" class="form-control" id="taskTitle" placeholder="Enter task title" value={newTask.title} onchange={handleTitleChange} required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Duration & Time Range</label>
                        <div class="time-inputs">
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">Hours</label>
                                <select class="form-control" id="taskHours" data-id="taskHours" onchange={updateTaskTimes}>
                                    <template for:each={hoursOptions} for:item="h">
                                        <option key={h.value} value={h.value} selected={h.selected}>{h.label}</option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">Minutes</label>
                                <select class="form-control" id="taskMinutes" data-id="taskMinutes" onchange={updateTaskTimes}>
                                    <template for:each={minutesOptions} for:item="m">
                                        <option key={m.value} value={m.value} selected={m.selected}>{m.label}</option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">From</label>
                                <div class="time-display" id="taskFrom">{newTask.startTime}</div>
                            </div>
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">To</label>
                                <div class="time-display" id="taskTo">{newTask.endTime}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="taskDescription" rows="3" placeholder="Describe the work performed (optional)" onchange={handleDescChange}>{newTask.description}</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick={closeTaskForm}>Cancel</button>
                    <button type="button" class="btn btn-primary" onclick={saveTask}>Save Task</button>
                </div>
            </form>
        </div>
    </div>

</template>
