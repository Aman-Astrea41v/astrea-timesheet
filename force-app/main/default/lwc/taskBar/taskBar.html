<template>
     <div id="home" class="page">
            <div class="dashboard-grid">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Today's Tasks</h2>

                        <div class="task-filter-panel">
                            <input type="date" class="filter-date-task" onchange={filterTaskByDate} max={today}>
                            <lightning-button-icon class="btn" icon-name="utility:left" onclick={decreaseDate}></lightning-button-icon>
                            <button class="btn btn-info" onclick={getTodaysTask} disabled={isToday}>Today</button>
                            <lightning-button-icon icon-name="utility:right" class="btn" onclick={increaseDate} disabled={isNotTomorrow}></lightning-button-icon>
                        </div>  

                        <button class="btn btn-success" onclick={openTaskForm} disabled={disableTaskButton}>
                            {taskButtonTitle}
                        </button>
                    </div>
                    <div class="section-content">

                        <div class="loader" if:true={isLoading}>
                            <lightning-spinner
                                alternative-text="Loading..."
                                size="medium"
                                variant="brand">
                            </lightning-spinner>
                        </div>


                        <table class="data-table" if:false={isLoading}>
                        
                            <thead>
                                <tr>
                                    <th>Task Title</th>
                                    <th>Time Range</th>
                                    <th>Duration</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>

                            
                            <tbody id="tasksTableBody" if:true={tasks.length}>
                                <template for:each={tasks} for:item="task">
                                    <tr key={task.id}>
                                        <td class="font-weight-bold">
                                            {task.formatTitle}
                                            <span class="status-badge category-badge" style="margin-left: 0.5rem;">
                                                {task.category}
                                            </span>
                                        </td>
                                        <td><code>{task.startTime} - {task.endTime}</code></td>
                                        <td>
                                            <span class="status-badge status-in">
                                                {task.formattedDuration}
                                            </span>
                                        </td>
                                        <td class="text-muted">{task.formatDescription}</td>
                                        <td class="btn-actions">

                                            <lightning-icon
                                                icon-name="utility:edit"
                                                alternative-text="Edit"
                                                title="Edit"
                                                size="x-small"
                                                class="icon edit-icon edit-btn"
                                                onclick={editTask}
                                                data-id={task.id}>
                                            </lightning-icon>

                                            <lightning-icon
                                                icon-name="utility:delete"
                                                alternative-text="Delete"
                                                title="Delete"
                                                size="x-small"
                                                class="icon delete-icon del-btn"
                                                onclick={deleteTask}
                                                data-id={task.id}>
                                            </lightning-icon>
                                            
                                        </td>
                                    </tr>
                                </template>
                            </tbody>

                            <tbody id="tasksTableBodyEmpty" if:false={tasks.length}>
                                <tr>
                                    <td colspan="5" class="empty-state">
                                        <div class="empty-state-title">No tasks recorded</div>
                                        <div>Click "Add Task" to start tracking your work</div>
                                    </td>
                                </tr>
                            </tbody>

                        </table>

                        <div class="font-weight-bold" style="color: #2c5aa0; font-size:medium;">Daily Total: {statusPanel.dailyTotal}</div>
                    </div>
                </div>

                <div class={statusPanel.class} id="statusPanel" if:false={isLoading}>
                    <div class="status-indicator">{statusPanel.indicator}</div>
                    <div class="status-text" id="statusText">{statusPanel.text}</div>
                    <div class="status-detail" id="statusDetail">{statusPanel.workType}</div>
                    <div class="status-time" id="statusTime">{statusPanel.punchTime}</div>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
                        <div class="text-muted" style="font-size: 0.875rem;">Working Hours</div>
                        <div class="font-weight-bold" style="color: #2c5aa0;" id="dailyTotal">{workingHours}</div>
                    </div>
                </div>

            </div>
        </div>


        <div class="modal" id="taskModal" if:true={showTaskForm}>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">{modalTitle}</h3>
                <button class="modal-close" onclick={closeTaskForm}>&times;</button>
            </div>
            <form id="taskForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Task Title</label>
                        <input type="text" class="form-control" id="taskTitle" placeholder="Enter task title" value={newTask.title} onchange={handleTitleChange} required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-control" onchange={handleCategoryChange}>
                            <template for:each={categoryOptions} for:item="c">
                                <option key={c.value} value={c.value} selected={c.selected}>{c.label}</option>
                            </template>
                        </select>
                    </div>

                    <template if:true={showOtherCategoryText}>
                        <div class="form-group">
                            <label class="form-label">Please specify</label>
                            <input type="text" class="form-control" placeholder="Enter other task" value={newTask.otherCategory} onchange={handleOtherCategory}>
                        </div>
                    </template>

                    <div class="form-group">
                        <label class="form-label">Duration & Time Range</label>
                        <div class="time-inputs">
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">Hours</label>
                                <select class="form-control" id="taskHours" data-id="taskHours" onchange={updateTaskTimes}>
                                    <template for:each={hoursOptions} for:item="h">
                                        <option key={h.value} value={h.value} selected={h.selected}>{h.label}</option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">Minutes</label>
                                <select class="form-control" id="taskMinutes" data-id="taskMinutes" onchange={updateTaskTimes}>
                                    <template for:each={minutesOptions} for:item="m">
                                        <option key={m.value} value={m.value} selected={m.selected}>{m.label}</option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">From</label>
                                <input class="time-display" type="time" name="startTime" id="taskFrom" onchange={updateStartTime} value={newTask.startTime}>
                            </div>
                            <div>
                                <label class="form-label" style="font-size: 0.875rem; margin-bottom: 0.25rem;">To</label>
                                <input class="time-display" type="time" name="endTime" id="taskTo" onchange={updateEndTime} value={newTask.endTime}>
                            </div>
                        </div>
                    </div>

                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="taskDescription" rows="3" placeholder="Describe the work performed (optional)" onchange={handleDescChange}>{newTask.description}</textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick={closeTaskForm}>Cancel</button>
                    <button type="button" class="btn btn-primary" onclick={saveTask} disabled={allowSaveTask}>Save Task</button>
                </div>
            </form>
        </div>
    </div>


</template>
